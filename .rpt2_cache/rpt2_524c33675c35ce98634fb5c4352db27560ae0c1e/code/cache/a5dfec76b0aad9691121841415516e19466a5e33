{
  "code": "import BaseView from \"./BaseView\";\r\nexport default class RayCastToMoveView extends BaseView {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.ray = new Laya.Ray(new Laya.Vector3(0, 0, 0), new Laya.Vector3(0, -2, 0));\r\n        this.hitResult = new Laya.HitResult();\r\n        this.moveDir = new Laya.Vector3;\r\n        this.moveSpeed = 0.01;\r\n    }\r\n    onAwake() {\r\n        super.onAwake();\r\n        this.bgBox.height = Laya.stage.height - (this.bgBox.top ? this.bgBox.top : 0)\r\n            - (this.bgBox.bottom ? this.bgBox.bottom : 0);\r\n        Laya.Scene3D.load(\"scene3d/LayaScene_MoveCtrler/Conventional/MoveCtrler.ls\", Laya.Handler.create(this, this.onLoadSceneComplete));\r\n    }\r\n    onLoadSceneComplete(scene3d) {\r\n        this.bgBox.visible = false;\r\n        this.addChildAt(scene3d, 0);\r\n        let cam = scene3d.getChildByName(\"Main Camera\");\r\n        let cube = scene3d.getChildByName(\"Cube\");\r\n        let canMove = false;\r\n        this.on(Laya.Event.MOUSE_DOWN, this, () => {\r\n            canMove = false;\r\n            var point = new Laya.Vector2();\r\n            point.x = Laya.MouseManager.instance.mouseX;\r\n            point.y = Laya.MouseManager.instance.mouseY;\r\n            cam.viewportPointToRay(point, this.ray);\r\n            scene3d.physicsSimulation.rayCast(this.ray, this.hitResult);\r\n        });\r\n        let nextPos = new Laya.Vector3;\r\n        let deltaVector = new Laya.Vector3;\r\n        let curMoveDir = new Laya.Vector3;\r\n        Laya.timer.frameLoop(1, this, () => {\r\n            if (!canMove)\r\n                return;\r\n            Laya.Vector3.subtract(this.hitResult.point, cube.transform.position, curMoveDir);\r\n            if (Laya.Vector3.dot(this.moveDir, curMoveDir) > 0) {\r\n                Laya.Vector3.scale(this.moveDir, Laya.timer.delta * this.moveSpeed, deltaVector);\r\n                Laya.Vector3.add(cube.transform.position, deltaVector, nextPos);\r\n                cube.transform.position = nextPos;\r\n            }\r\n            else {\r\n                cube.transform.position = this.hitResult.point;\r\n                canMove = false;\r\n            }\r\n        });\r\n        this.on(Laya.Event.MOUSE_UP, this, () => {\r\n            if (!this.hitResult.succeeded)\r\n                return;\r\n            console.log(\"点中了: \" + this.hitResult.collider.owner.name);\r\n            if (\"Plane\" != this.hitResult.collider.owner.name)\r\n                return;\r\n            this.hitResult.point.y = cube.transform.position.y;\r\n            Laya.Vector3.subtract(this.hitResult.point, cube.transform.position, this.moveDir);\r\n            Laya.Vector3.normalize(this.moveDir, this.moveDir);\r\n            let lookAtPos = new Laya.Vector3();\r\n            Laya.Vector3.add(cube.transform.position, new Laya.Vector3(-this.moveDir.x, 0, -this.moveDir.z), lookAtPos);\r\n            cube.transform.lookAt(lookAtPos, new Laya.Vector3(0, 1, 0), false);\r\n            canMove = true;\r\n        });\r\n    }\r\n}\r\n//# sourceMappingURL=RayCastToMoveView.js.map",
  "references": [
    "D:/LayaProject/LayaToolBox-master/src/Util/GameUtils.ts",
    "D:/LayaProject/LayaToolBox-master/src/View/BaseView.ts"
  ],
  "map": "{\"version\":3,\"file\":\"RayCastToMoveView.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../src/View/RayCastToMoveView.ts\"],\"names\":[],\"mappings\":\"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\"}"
}
